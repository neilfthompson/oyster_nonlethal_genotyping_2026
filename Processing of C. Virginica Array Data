---
title: "Array Data Processing"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Information on samples and genotyping:
66K Eastern Oyster HD Array data generated by Center for Aquaculture Technology (San Diego CA)  in 2022 and 2023. Two rounds of genotyping were conducted: an initial
round with N=26 swab or nonlethal samples (10 eDNA, 8 cytology swab or 8 mantle clip) plus N=26 paired adductor samples in which extracted DNA was sent to CAT 
and then  a second round with N=30 swab samples 10 each of cytology swab, cotton swab or mascara swab plus N=30 paired adductor samples in which whole 
tissue or swab was sent directly to CAT. Data filtered using the SNP polisher list and then exported as PLINK .ped/.map file. The .ped file was loaded 
directly into R for testing of genotyping concordance. 

## load and test 1st round of genotyping samples.
```{r, load-ped}

library(dplyr)
library(ggplot2)
library(tidyverse)

ped922 <-read.table("G0922_07_UMD.ped ")
dim(ped922)
ped922.AA<-cbind(ped922 [1], mapply(paste0, ped922[, seq(7,ncol(ped922),2)],ped922[,seq(8,ncol(ped922),2)]))
ped922.AA[ped922.AA == "00"]<-NA

#Add sample info and subset to only relevant samples

QC<-read.csv("G0922-07-UMD_Sample_QC_Table_with BIOPSY sample info.csv",header=TRUE)

QC<-QC[-288,]
ped922.AA[["V1"]]<-QC$HPLID

ped922.AA<-ped922.AA[321:371,]
ped922.AA.ord<-ped922.AA %>% arrange(desc(V1))

#Manual Clean UP and order

ped922.AA.ord.clean<-ped922.AA.ord[-c(1:2,21,41),]

ped922.AA.ord.clean<-ped922.AA.ord.clean %>% mutate(nreps=if_else(row_number() == 5,2,1)) %>% uncount(nreps)

ped922.AA.ord.clean$V1[6] <-"HPL Biospsy 2022, 8b Add (DNA)"
ped922.AA.ord.clean<-ped922.AA.ord.clean %>% arrange(desc(V1))
ped922.AA.ord.clean<-ped922.AA.ord.clean[-c(7,22),]
ped922.AA.ord.clean<-ped922.AA.ord.clean[,-1]

#sample names are row names

row.names(ped922.AA.ord.clean)<-ped922.AA.ord.clean$V1
ped922.AA.ord.clean<-ped922.AA.ord.clean[,-1]
```
Testing 1st rd samples. 
```{r Concordance test script}
INSERT ONCE EVERNOTE IS ACCESSIBLE...


```



## load and test 2ND round of genotyping samples (minimal cleanup)

```{r load-ped and cleanup}
ped124<-read.table("G0124-04-UMD.ped")
names<-read.table("names.txt")
ped124$V1[57]<-"HPL-02376_283925_L22.CEL"
ped124.filt<-ped124[!grepl("Replicate",ped124$V1),]

ped124.filt.clean<-ped124.filt[1:60,]
ped124.filt.clean[["V1"]]<-names

ped124.AA<-cbind(ped124.filt.clean [1], mapply(paste0, ped124.filt.clean[, seq(7,ncol(ped124.filt.clean),2)],ped124.filt.clean[,seq(8,ncol(ped124.filt.clean),2)]))
ped124.AA[ped124.AA == "00"]<-NA
row.names(ped124.AA)<-ped124.AA$V1
ped124.AA<-ped124.AA[,-1]
```

Testing 2nd rd samples. 
```{r Concordance test script}
vect_1 <- c(seq(from=1,to=59,by=2))
vect_2 <- double(length(vect_1))
names<-row.names(ped.AA)

for(num in vect_1) {
    vect_2[num] <- as.numeric(table(ped.AA[num,] == ped.AA[num+1,]))[1]/(as.numeric(table(ped.AA[num,] == ped.AA[num+1,]))[1] + as.numeric(table(ped.AA[num,] == ped.AA[num+1,]))[2])*100
}

vect_2
output<-cbind(names[seq(from=1,to=59,by=2)],vect_2[seq(from=1,to=59,by=2)])
output

```



```
